<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Guide to Graduate</title>
    <link rel="stylesheet" href="/pages/staff/CSS/tl.css">
</head>
<body>
    <div id="navbar-placeholder"></div>
    <script src="/loadlayout1"></script>
    <div >
        <div class="header">
            <h1>Timeline Guide to Graduate</h1>
            <div class="buttons">
                <button>Notification</button>
                <button style="background-color: #007bff;color: white;">Note</button>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>TIMELINE</th>
                    <th>START</th>
                    <th>END</th>
                    <th>STATUS</th>
                </tr>
            </thead>
            <tbody id="timeline-body">
                <!-- Rows will be inserted here by JavaScript -->
            </tbody>
        </table>
        <div class="precautions">
            <h2>Precautions students</h2>
        </div>
        <div class="status-explanation">
            <span class="status safe">Safe</span>
            <span class="status warning">Warning</span>
            <span class="status retried">Retried</span>
        </div>
        <div class="precaution-list">
            <div class="precaution safe">1. Academic year</div>
            <div class="precaution safe">2. Qualifying exam</div>
            <div class="precaution warning">3. Proposal test</div>
            <div class="precaution safe">4. English proficiency score</div>
            <div class="precaution safe">5. Take a leave</div>
            <div class="precaution safe">6. GPAX > 3.00</div>
            <div class="precaution warning">7. Get "U" 2 times</div>
            <div class="precaution safe">8. Corrupt</div>
            <div class="precaution safe">9. Payment tuition fees</div>
        </div>
        <br>
    </div>
    <script>
        async function fetchUserData() {
            try {
                const response = await fetch('/getuser/5971105504');
                const data = await response.json();
                if (data.status === 'success') {
                    populateTable(data.user, data.researchStatus);
                } else {
                    console.error(data.message);
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }

        function populateTable(user, researchStatus) {
            const statusBits = getStatusBits(user.STATUS);
            const timelineBody = document.getElementById('timeline-body');
            timelineBody.innerHTML = `
                <tr>
                    <td>1 Research ethics training</td>
                    <td>01-01-2024</td>
                    <td>01-04-2024</td>
                    <td><span class="status ${getStatusClass(statusBits[10], 'ethics')}">${getStatusText(statusBits[10], 'ethics')}</span></td>
                </tr>
                <tr>
                    <td>2 Appoint a consultant</td>
                    <td>01-01-2024</td>
                    <td>01-04-2024</td>
                    <td><span class="status ${researchStatus > 2 ? 'pass' : 'waiting'}">${researchStatus > 2 ? 'PASS' : 'WAITING'}</span></td>
                </tr>
                <tr>
                    <td>3 Propose an outline</td>
                    <td>01-01-2024</td>
                    <td>01-04-2024</td>
                    <td><span class="status ${researchStatus > 3 ? 'pass' : 'waiting'}">${researchStatus > 3 ? 'PASS' : 'WAITING'}</span></td>
                </tr>
                <tr>
                    <td>4 Comprehensive examination</td>
                    <td>01-01-2024</td>
                    <td>01-04-2024</td>
                    <td><span class="status ${getStatusClass([statusBits[4], statusBits[5]], 'comprehensive')}">${getStatusText([statusBits[4], statusBits[5]], 'comprehensive')}</span></td>
                </tr>
                <tr>
                    <td>5 Publish research results</td>
                    <td>01-01-2024</td>
                    <td>01-04-2024</td>
                    <td><span class="status ${getStatusClass(statusBits[6], 'publish')}">${getStatusText(statusBits[6], 'publish')}</span></td>
                </tr>
                <tr>
                    <td>6 Defense exam</td>
                    <td>01-01-2024</td>
                    <td>01-04-2024</td>
                    <td><span class="status ${researchStatus > 6 ? 'pass' : 'waiting'}">${researchStatus > 6 ? 'PASS' : 'WAITING'}</span></td>
                </tr>
                <tr>
                    <td>7 Send printing format check</td>
                    <td>01-01-2024</td>
                    <td>01-04-2024</td>
                    <td><span class="status ${researchStatus > 7 ? 'pass' : 'waiting'}">${researchStatus > 7 ? 'PASS' : 'WAITING'}</span></td>
                </tr>
            `;
        }

        function getStatusBits(status) {
            const binaryString = Number(status).toString(2).padStart(11, '0');
            return binaryString.split('').reverse().map(Number);
        }

        function getStatusClass(bits, type) {
            switch (type) {
                case 'ethics':
                    return bits === 1 ? 'pass' : 'failed';
                case 'comprehensive':
                    if (bits[0] === 0 && bits[1] === 0) return 'waiting';
                    if (bits[0] === 1 && bits[1] === 0) return 'failed';
                    if (bits[0] === 0 && bits[1] === 1) return 'pass';
                case 'publish':
                    return bits === 1 ? 'pass' : 'waiting';
                default:
                    return '';
            }
        }

        function getStatusText(bits, type) {
            switch (type) {
                case 'ethics':
                    return bits === 1 ? 'PASS' : 'FAILED';
                case 'comprehensive':
                    if (bits[0] === 0 && bits[1] === 0) return 'WAITING';
                    if (bits[0] === 1 && bits[1] === 0) return 'FAILED';
                    if (bits[0] === 0 && bits[1] === 1) return 'PASS';
                case 'publish':
                    return bits === 1 ? 'PASS' : 'WAITING';
                default:
                    return '';
            }
        }

        fetchUserData();
    </script>
</body>
</html>
